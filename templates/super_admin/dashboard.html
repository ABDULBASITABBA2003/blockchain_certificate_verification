{% extends "base.html" %}

{% block content %}

<div class="container py-4">

    <!-- PAGE TITLE -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-white">Super Admin Dashboard</h2>

        <a href="{{ url_for('super_admin.logout') }}" class="btn btn-outline-danger">
            Logout
        </a>
    </div>

    <!-- STATS CARD & ACTION -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="card shadow-sm border-0 rounded-3 text-white"
                style="background: linear-gradient(135deg, #FF512F, #DD2476);">
                <div class="card-body p-4">
                    <h5 class="card-title fw-bold">Total Admins</h5>
                    <p class="display-4 fw-bold mb-0">{{ total_admins }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 d-flex align-items-center justify-content-end">
            <a href="{{ url_for('super_admin.add_admin') }}" class="btn btn-lg shadow text-white px-4 py-3 fw-bold"
                style="background: linear-gradient(135deg,#6a11cb,#8e2de2); border-radius: 10px;">
                <i class="bi bi-person-plus-fill me-2"></i> Add New Admin
            </a>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} mt-2 auto-dismiss-alert">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <form method="GET" action="{{ url_for('super_admin.dashboard') }}" class="row g-2 mb-3">
        <div class="col-md-8 col-lg-6">
            <input type="text" name="search" class="form-control"
                placeholder="Search by name, school name, or email" value="{{ search_term or '' }}">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
        {% if search_term %}
        <div class="col-auto">
            <a href="{{ url_for('super_admin.dashboard') }}" class="btn btn-outline-secondary">Clear</a>
        </div>
        {% endif %}
    </form>


    <!-- ADMINS TABLE -->
    <div class="card shadow-lg border-0 rounded-3">

        <div class="card-header text-white fw-bold py-3" style="background: linear-gradient(135deg,#6a11cb,#8e2de2);">
            Registered School Admins
        </div>

        <div class="card-body">

            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>School Name</th>
                        <th>Date of Creation</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody>
                    {% for admin in admins %}
                    <tr>
                        <td class="fw-semibold">{{ admin.id }}</td>
                        <td>{{ admin.username }}</td>
                        <td>{{ admin.email }}</td>
                        <td class="fw-bold text-muted">{{ admin.school_name }}</td>
                        <td>
                            {{ admin.created_at.strftime('%Y-%m-%d') }}
                        </td>
                        <td>
                            <div class="d-flex gap-2 flex-wrap">
                                <a href="{{ url_for('super_admin.edit_admin', admin_id=admin.id) }}"
                                    class="btn btn-sm btn-outline-warning">Edit</a>
                                <form action="{{ url_for('super_admin.delete_admin', admin_id=admin.id) }}" method="POST"
                                    onsubmit="return confirm('Are you sure you want to delete this admin?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% if admins|length == 0 %}
            <p class="text-muted text-center py-3">
                No admins found.
            </p>
            {% endif %}

        </div>
    </div>

</div>

<!-- STYLE -->
<style>
    body {
        background: url('/static/images/hero1.jpg') no-repeat center center fixed;
        background-size: cover;
    }

    .table th {
        font-weight: 600;
        color: #333;
    }

    .card-header {
        font-size: 1.1rem;
    }
</style>

<script>
    setTimeout(function () {
        document.querySelectorAll('.auto-dismiss-alert').forEach(function (alertEl) {
            alertEl.style.transition = 'opacity 0.5s ease';
            alertEl.style.opacity = '0';
            setTimeout(function () {
                alertEl.remove();
            }, 500);
        });
    }, 3000);
</script>

{% endblock %}